var PusherControl = {
  get_pusher: (function () {
    var pusher = new Pusher('<%=ENV['PUSHER_APP_KEY']%>');
    return function () {return pusher;}
  })(),
  setup: function () {
    var pusher = PusherControl.get_pusher();

    // the following is used only for test purposes
    var channel = pusher.subscribe('my_channel');
    channel.bind('new_message', function(data) {
      alert('From: ' + data.name + ', Message: ' + data.message);
    });

    // pusher_control channel is used to send
    // server-originated events to clients
    var channel = pusher.subscribe('pusher_control');

    channel.bind('js_registered', function(data) {
      // Process event if I am logged in and am an agency_person
      if (Cookies('person_id') && (Cookies('person_type') === 'AgencyPerson') ) {
        alert('Job Seeker: ' + data.name + ' has joined PETS.');
      }
    });
  }
};

$(PusherControl.setup);
